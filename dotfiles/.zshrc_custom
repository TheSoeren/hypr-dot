# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

# Function to change directory to a project
cd_to_project() {
  if [ -z "$1" ]; then
    echo "Please provide a project name."
    return 1
  fi

  # Define the base directory for projects
  local PROJECTS_DIR="/home/soeren/projects"

  # Construct the full path to the project
  local PROJECT_PATH="$PROJECTS_DIR/$1"

  # Check if the project directory exists
  if [ -d "$PROJECT_PATH" ]; then
    cd "$PROJECT_PATH" || return
  else
    echo "Project '$1' does not exist."
    return 1
  fi
}

######################
### CUSTOM ALIASES ###
######################

# Autocomplete function for the 'start' command
_start_project_cmp()
{
  local cur
  cur="${COMP_WORDS[COMP_CWORD]}"
  local projects_dir="/home/soeren/projects"
  
  if [ -d "$projects_dir" ]; then
    local projects=$(ls -1 "$projects_dir")
    COMPREPLY=( $(compgen -W "$projects" -- "$cur") )
  fi
}

alias project='cd_to_project'
alias p='cd_to_project'

# Register the autocomplete function for the 'project' command
complete -F _start_project_cmp cd_to_project

################
### PNPM CLI ###
################

export PNPM_HOME="/home/soeren/.local/share/pnpm"
case ":$PATH:" in
  *":$PNPM_HOME:"*) ;;
  *) export PATH="$PNPM_HOME:$PATH" ;;
esac

#######################
### PROTON GE SETUP ###
#######################
export ASDF_PROTONGE_STEAM_COMPAT_DIR=~/.var/app/com.valvesoftware.Steam/data/Steam/compatibilitytools.d/
autoload -Uz compinit
compinit

zstyle ':completion:*' menu select
zstyle ':completion::complete:*' gain-privileges 1

# append completions to fpath
fpath=(${ASDF_DATA_DIR:-$HOME/.asdf}/completions $fpath)
# initialise completions with ZSH's compinit
autoload -Uz compinit && compinit
